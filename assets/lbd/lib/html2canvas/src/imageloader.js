function ImageLoader(e,t){this.link=null,this.options=e,this.support=t,this.origin=this.getOrigin(window.location.href)}ImageLoader.prototype.findImages=function(e){var t=[];return e.reduce(function(e,t){switch(t.node.nodeName){case"IMG":return e.concat([{args:[t.node.src],method:"url"}]);case"svg":case"IFRAME":return e.concat([{args:[t.node],method:t.node.nodeName}])}return e},[]).forEach(this.addImage(t,this.loadImage),this),t},ImageLoader.prototype.findBackgroundImage=function(e,t){return t.parseBackgroundImages().filter(this.hasImageBackground).forEach(this.addImage(e,this.loadImage),this),e},ImageLoader.prototype.addImage=function(n,i){return function(t){t.args.forEach(function(e){this.imageExists(n,e)||(n.splice(0,0,i.call(this,t)),log("Added image #"+n.length,"string"==typeof e?e.substring(0,100):e))},this)}},ImageLoader.prototype.hasImageBackground=function(e){return"none"!==e.method},ImageLoader.prototype.loadImage=function(e){if("url"!==e.method)return"linear-gradient"===e.method?new LinearGradientContainer(e):"gradient"===e.method?new WebkitGradientContainer(e):"svg"===e.method?new SVGNodeContainer(e.args[0],this.support.svg):"IFRAME"===e.method?new FrameContainer(e.args[0],this.isSameOrigin(e.args[0].src),this.options):new DummyImageContainer(e);var t=e.args[0];return!this.isSVG(t)||this.support.svg||this.options.allowTaint?t.match(/data:image\/.*;base64,/i)?new ImageContainer(t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),!1):this.isSameOrigin(t)||!0===this.options.allowTaint||this.isSVG(t)?new ImageContainer(t,!1):this.support.cors&&!this.options.allowTaint&&this.options.useCORS?new ImageContainer(t,!0):this.options.proxy?new ProxyImageContainer(t,this.options.proxy):new DummyImageContainer(t):new SVGContainer(t)},ImageLoader.prototype.isSVG=function(e){return"svg"===e.substring(e.length-3).toLowerCase()||SVGContainer.prototype.isInline(e)},ImageLoader.prototype.imageExists=function(e,t){return e.some(function(e){return e.src===t})},ImageLoader.prototype.isSameOrigin=function(e){return this.getOrigin(e)===this.origin},ImageLoader.prototype.getOrigin=function(e){var t=this.link||(this.link=document.createElement("a"));return t.href=e,t.href=t.href,t.protocol+t.hostname+t.port},ImageLoader.prototype.getPromise=function(t){return this.timeout(t,this.options.imageTimeout).catch(function(){return new DummyImageContainer(t.src).promise.then(function(e){t.image=e})})},ImageLoader.prototype.get=function(t){var n=null;return this.images.some(function(e){return(n=e).src===t})?n:null},ImageLoader.prototype.fetch=function(e){return this.images=e.reduce(bind(this.findBackgroundImage,this),this.findImages(e)),this.images.forEach(function(t,n){t.promise.then(function(){log("Succesfully loaded image #"+(n+1),t)},function(e){log("Failed loading image #"+(n+1),t,e)})}),this.ready=Promise.all(this.images.map(this.getPromise,this)),log("Finished searching images"),this},ImageLoader.prototype.timeout=function(n,i){var o,e=Promise.race([n.promise,new Promise(function(e,t){o=setTimeout(function(){log("Timed out loading image",n),t(n)},i)})]).then(function(e){return clearTimeout(o),e});return e.catch(function(){clearTimeout(o)}),e};