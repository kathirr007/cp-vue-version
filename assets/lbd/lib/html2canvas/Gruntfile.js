var _=require("lodash"),path=require("path"),proxy=require("html2canvas-proxy");module.exports=function(t){var e={banner:'/*\n  <%= pkg.title || pkg.name %> <%= pkg.version %><%= pkg.homepage ? " <" + pkg.homepage + ">" : "" %>\n  Copyright (c) <%= grunt.template.today("yyyy") %> <%= pkg.author.name %>\n\n  Released under <%= _.pluck(pkg.licenses, "type").join(", ") %> License\n*/\n',pre:"\n(function(window, document, exports, global, define, undefined){\n\n",post:'\n}).call({}, typeof(window) !== "undefined" ? window : undefined, typeof(document) !== "undefined" ? document : undefined);'},r={chrome:{browserName:"chrome",platform:"Windows 7",version:"39"},firefox:{browserName:"firefox",version:"15",platform:"Windows 7"},ie9:{browserName:"internet explorer",version:"9",platform:"Windows 7"},ie10:{browserName:"internet explorer",version:"10",platform:"Windows 8"},ie11:{browserName:"internet explorer",version:"11",platform:"Windows 8.1"},safari6:{browserName:"safari",version:"6",platform:"OS X 10.8"},safari7:{browserName:"safari",platform:"OS X 10.9",version:"7"},chromeOSX:{browserName:"chrome",platform:"OS X 10.8",version:"39"}};t.initConfig({pkg:t.file.readJSON("package.json"),concat:{dist:{src:["src/promise.js","src/fallback.js","src/punycode/punycode.js","src/core.js","src/*.js","src/renderers/*.js"],nonull:!0,dest:"dist/<%= pkg.name %>.js",options:{banner:e.banner+e.pre,footer:e.post}},svg:{src:["src/fabric/dist/fabric.js"],dest:"dist/<%= pkg.name %>.svg.js",options:{banner:e.banner+"\n(function(window, document, exports, undefined){\n\n",footer:"\n}).call({}, window, document, html2canvas);"}}},connect:{server:{options:{port:8080,base:"./",keepalive:!0}},altServer:{options:{port:8083,base:"./"}},cors:{options:{port:8081,base:"./",middleware:function(e,r){return[function(e,r,s){"/tests/assets/image2.jpg"===e.url?(r.setHeader("Access-Control-Allow-Origin","*"),r.end(require("fs").readFileSync("tests/assets/image2.jpg"))):s()}]}}},proxy:{options:{port:8082,middleware:function(e,r){return[function(r,s,e){s.jsonp=function(e){s.end(r.query.callback+"("+JSON.stringify(e)+")")},e()},proxy()]}}},ci:{options:{port:8080,base:"./"}}},execute:{fabric:{options:{args:["modules="+["text","serialization","parser","gradient","pattern","shadow","freedrawing","image_filters","serialization"].join(","),"no-es5-compat","dest="+path.resolve(__dirname,"src/fabric/dist/")+"/"]},src:["src/fabric/build.js"]}},uglify:{dist:{src:["<%= concat.dist.dest %>"],dest:"dist/<%= pkg.name %>.min.js"},svg:{src:["<%= concat.svg.dest %>"],dest:"dist/<%= pkg.name %>.svg.min.js"},options:{banner:e.banner}},watch:{files:["src/**/*","!src/fabric/**/*"],tasks:["jshint","build"]},jshint:{all:["src/*.js","src/renderers/*.js","!src/promise.js"],options:t.file.readJSON("./.jshintrc")},mochacli:{options:{reporter:"spec"},all:["tests/node/*.js"]},mocha_phantomjs:{all:["tests/mocha/**/*.html"]},mocha_webdriver:r,webdriver:r}),t.registerTask("webdriver","Browser render tests",function(e,r){var s=require("./tests/selenium.js"),n=this.async(),o=e?[t.config.get(this.name+"."+e)]:_.values(t.config.get(this.name));s.tests(o,r).catch(function(){n(!1)}).finally(function(){console.log("Done"),n()})}),t.registerTask("mocha_webdriver","Browser mocha tests",function(e,r){var s=require("./tests/mocha/selenium.js"),n=this.async(),o=e?[t.config.get(this.name+"."+e)]:_.values(t.config.get(this.name));s.tests(o,r).catch(function(){n(!1)}).finally(function(){n()})}),t.loadNpmTasks("grunt-mocha-phantomjs"),t.loadNpmTasks("grunt-contrib-watch"),t.loadNpmTasks("grunt-contrib-concat"),t.loadNpmTasks("grunt-contrib-uglify"),t.loadNpmTasks("grunt-contrib-jshint"),t.loadNpmTasks("grunt-contrib-connect"),t.loadNpmTasks("grunt-execute"),t.loadNpmTasks("grunt-mocha-cli"),t.registerTask("server",["connect:cors","connect:proxy","connect:altServer","connect:server"]),t.registerTask("build",["execute","concat","uglify"]),t.registerTask("default",["jshint","build","mochacli","connect:altServer","mocha_phantomjs"]),t.registerTask("travis",["jshint","build","connect:altServer","connect:ci","connect:proxy","connect:cors","mocha_phantomjs","webdriver"])};