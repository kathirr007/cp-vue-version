tinymce._beforeUnloadHandler=function(){var t;return tinymce.each(tinymce.editors,function(e){e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&e.getParam("autosave_ask_before_unload",!0)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t},tinymce.PluginManager.add("autosave",function(n){function e(e,t){return((e=/^(\d+)([ms]?)$/.exec(""+(e||t)))[2]?{s:1e3,m:6e4}[e[2]]:1)*parseInt(e,10)}function t(){var e=parseInt(m.getItem(f+"time"),10)||0;return!((new Date).getTime()-e>d.autosave_retention)||(a(!1),!1)}function a(e){m.removeItem(f+"draft"),m.removeItem(f+"time"),!1!==e&&n.fire("RemoveDraft")}function r(){!u()&&n.isDirty()&&(m.setItem(f+"draft",n.getContent({format:"raw",no_events:!0})),m.setItem(f+"time",(new Date).getTime()),n.fire("StoreDraft"))}function o(){t()&&(n.setContent(m.getItem(f+"draft"),{format:"raw"}),n.fire("RestoreDraft"))}function i(){var e=this;e.disabled(!t()),n.on("StoreDraft RestoreDraft RemoveDraft",function(){e.disabled(!t())}),c||(setInterval(function(){n.removed||r()},d.autosave_interval),c=!0)}function s(){n.undoManager.beforeChange(),o(),a(),n.undoManager.add()}function u(e){var t=n.settings.forced_root_block;return""===(e=tinymce.trim(void 0===e?n.getBody().innerHTML:e))||new RegExp("^<"+t+"[^>]*>((Â |&nbsp;|[ \t]|<br[^>]*>)+?|)</"+t+">|<br>$","i").test(e)}var f,c,d=n.settings,m=tinymce.util.LocalStorage;f=(f=(f=(f=d.autosave_prefix||"tinymce-autosave-{path}{query}-{id}-").replace(/\{path\}/g,document.location.pathname)).replace(/\{query\}/g,document.location.search)).replace(/\{id\}/g,n.id),d.autosave_interval=e(d.autosave_interval,"30s"),d.autosave_retention=e(d.autosave_retention,"20m"),n.addButton("restoredraft",{title:"Restore last draft",onclick:s,onPostRender:i}),n.addMenuItem("restoredraft",{text:"Restore last draft",onclick:s,onPostRender:i,context:"file"}),!1!==n.settings.autosave_restore_when_empty&&(n.on("init",function(){t()&&u()&&o()}),n.on("saveContent",function(){a()})),window.onbeforeunload=tinymce._beforeUnloadHandler,this.hasDraft=t,this.storeDraft=r,this.restoreDraft=o,this.removeDraft=a,this.isEmpty=u});