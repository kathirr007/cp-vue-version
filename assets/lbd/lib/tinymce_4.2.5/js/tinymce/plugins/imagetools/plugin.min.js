!function(c,l){"use strict";function t(t,e,n){if("string"!=typeof t)throw"invalid module definition, module id must be defined and be a string";if(e===l)throw"invalid module definition, dependencies must be specified";if(n===l)throw"invalid module definition, definition function must be specified";!function(t,e){for(var n,o=[],i=0;i<t.length;++i){if(!(n=u[t[i]]||a(t[i])))throw"module definition dependecy not found: "+t[i];o.push(n)}e.apply(null,o)}(e,function(){u[t]=n.apply(null,arguments)})}function a(t){for(var e=c,n=t.split(/[.\/]/),o=0;o<n.length;++o){if(!e[n[o]])return;e=e[n[o]]}return e}var u={};t("tinymce/imagetoolsplugin/Canvas",[],function(){function n(t,e,n){return t.width=e,t.height=n,t}return{create:function(t,e){return n(document.createElement("canvas"),t,e)},resize:n,get2dContext:function(t){return t.getContext("2d")}}}),t("tinymce/imagetoolsplugin/Mime",[],function(){return{guessMimeType:function(t){var e=function(t){var e=document.createElement("a");return e.href=t,e.pathname}(t).split("."),n=e[e.length-1];return n&&(n=n.toLowerCase()),{jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png"}[n]}}}),t("tinymce/imagetoolsplugin/ImageSize",[],function(){return{getWidth:function(t){return t.naturalWidth||t.width},getHeight:function(t){return t.naturalHeight||t.height}}}),t("tinymce/imagetoolsplugin/Conversions",["tinymce/util/Promise","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize"],function(t,n,o,i){function e(n){return new t(function(e){n.complete?e(n):n.addEventListener("load",function t(){n.removeEventListener("load",t),e(n)})})}function a(t){return e(t).then(function(t){var e;return e=n.create(i.getWidth(t),i.getHeight(t)),n.get2dContext(e).drawImage(t,0,0),e})}function r(n){return new t(function(t){var e=new XMLHttpRequest;e.open("GET",n,!0),e.responseType="blob",e.onload=function(){200==this.status&&t(this.response)},e.send()})}function c(c){return new t(function(t){var e,n,o,i,a,r;if(c=c.split(","),(i=/data:([^;]+)/.exec(c[0]))&&(a=i[1]),e=atob(c[1]),window.WebKitBlobBuilder){for(r=new WebKitBlobBuilder,n=new ArrayBuffer(e.length),o=0;o<n.length;o++)n[o]=e.charCodeAt(o);return r.append(n),void t(r.getBlob(a))}for(n=new Uint8Array(e.length),o=0;o<n.length;o++)n[o]=e.charCodeAt(o);t(new Blob([n],{type:a}))})}function l(n){return new t(function(t){var e=new FileReader;e.onloadend=function(){t(e.result)},e.readAsDataURL(n)})}return{blobToImage:function(o){return new t(function(t){function e(){n.removeEventListener("load",e),t(n)}var n=new Image;n.addEventListener("load",e),n.src=URL.createObjectURL(o),n.complete&&e()})},imageToBlob:function(t){return e(t).then(function(t){var e=t.src;return 0===e.indexOf("blob:")?r(e):0===e.indexOf("data:")?c(e):a(t).then(function(t){return c(t.toDataURL(o.guessMimeType(e)))})})},uriToBlob:function(t){return 0===t.indexOf("blob:")?r(t):0===t.indexOf("data:")?c(t):null},blobToDataUri:l,blobToBase64:function(t){return l(t).then(function(t){return t.split(",")[1]})},imageToCanvas:a,canvasToBlob:function(t,e){return c(t.toDataURL(e))},revokeImageUrl:function(t){URL.revokeObjectURL(t.src)}}}),t("tinymce/imagetoolsplugin/ImageTools",["tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize"],function(c,l,u){var s=c.revokeImageUrl;return{rotate:function(a,r){return c.blobToImage(a).then(function(t){var e=l.create(u.getWidth(t),u.getHeight(t)),n=l.get2dContext(e),o=0,i=0;return 90!=(r=r<0?360+r:r)&&270!=r||l.resize(e,e.height,e.width),90!=r&&180!=r||(o=e.width),270!=r&&180!=r||(i=e.height),n.translate(o,i),n.rotate(r*Math.PI/180),n.drawImage(t,0,0),s(t),c.canvasToBlob(e,a.type)})},flip:function(t,o){return c.blobToImage(t).then(function(t){var e=l.create(u.getWidth(t),u.getHeight(t)),n=l.get2dContext(e);return"v"==o?(n.scale(1,-1),n.drawImage(t,0,-e.height)):(n.scale(-1,1),n.drawImage(t,-e.width,0)),s(t),c.canvasToBlob(e)})},crop:function(t,n,o,i,a){return c.blobToImage(t).then(function(t){var e=l.create(i,a);return l.get2dContext(e).drawImage(t,-n,-o),s(t),c.canvasToBlob(e)})},resize:function(n,o,i){return c.blobToImage(n).then(function(t){var e=l.create(o,i);return l.get2dContext(e).drawImage(t,0,0,o,i),s(t),c.canvasToBlob(e,n.type)})}}}),t("tinymce/imagetoolsplugin/CropRect",["tinymce/dom/DomQuery","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Observable"],function(f,h,p,y,v){var b=0;return function(l,n,u,o){function s(t,e){return{x:e.x-t.x,y:e.y-t.y,w:e.w,h:e.h}}function e(e){function t(t,e){e.h<0&&(e.h=0),e.w<0&&(e.w=0),f("#"+m+"-"+t,o).css({left:e.x,top:e.y,width:e.w,height:e.h})}y.each(a,function(t){f("#"+m+"-"+t.name,o).css({left:e.w*t.xMul+e.x,top:e.h*t.yMul+e.y})}),t("top",{x:n.x,y:n.y,w:n.w,h:e.y-n.y}),t("right",{x:e.x+e.w,y:e.y,w:n.w-e.x-e.w+n.x,h:e.h}),t("bottom",{x:n.x,y:e.y+e.h,w:n.w,h:n.h-e.y-e.h+n.y}),t("left",{x:n.x,y:e.y,w:e.x-n.x,h:e.h}),t("move",e)}function i(t){e(l=t)}function d(t){i(function(t,e){return{x:e.x+t.x,y:e.y+t.y,w:e.w,h:e.h}}(u,t))}var g,a,t,r,c="mce-",m=c+"crid-"+b++;return a=[{name:"move",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:0,deltaH:0},{name:"nw",xMul:0,yMul:0,deltaX:1,deltaY:1,deltaW:-1,deltaH:-1},{name:"ne",xMul:1,yMul:0,deltaX:0,deltaY:1,deltaW:1,deltaH:-1},{name:"sw",xMul:0,yMul:1,deltaX:1,deltaY:0,deltaW:-1,deltaH:1},{name:"se",xMul:1,yMul:1,deltaX:0,deltaY:0,deltaW:1,deltaH:1}],r=["top","right","bottom","left"],f('<div id="'+m+'" class="'+c+'croprect-container" data-mce-bogus="all">').appendTo(o),y.each(r,function(t){f("#"+m,o).append('<div id="'+m+"-"+t+'"class="'+c+'croprect-block" style="display: none" data-mce-bogus="all">')}),y.each(a,function(t){f("#"+m,o).append('<div id="'+m+"-"+t.name+'" class="'+c+"croprect-handle "+c+"croprect-handle-"+t.name+'" style="display: none" data-mce-bogus="all">')}),t=y.map(a,function(r){var c;return new h(m,{document:o.ownerDocument,handle:m+"-"+r.name,start:function(){c=l},drag:function(t){var e,n,o,i,a;e=c.x,n=c.y,o=c.w,i=c.h,e+=t.deltaX*r.deltaX,n+=t.deltaY*r.deltaY,(o+=t.deltaX*r.deltaW)<20&&(o=20),(i+=t.deltaY*r.deltaH)<20&&(i=20),a=l=p.clamp({x:e,y:n,w:o,h:i},u,"move"==r.name),a=s(u,a),g.fire("updateRect",{rect:a}),d(a)}})}),e(l),g=y.extend({toggleVisibility:function(t){var e;e=y.map(a,function(t){return"#"+m+"-"+t.name}).concat(y.map(r,function(t){return"#"+m+"-"+t})).join(","),t?f(e,o).show():f(e,o).hide()},setClampRect:function(t){u=t,e(l)},setRect:i,getInnerRect:function(){return s(u,l)},setInnerRect:d,setViewPortRect:function(t){n=t,e(l)},destroy:function(){y.each(t,function(t){t.destroy()}),t=[]}},v)}}),t("tinymce/imagetoolsplugin/ImagePanel",["tinymce/ui/Control","tinymce/ui/DragHelper","tinymce/ui/Rect","tinymce/util/Tools","tinymce/util/Promise","tinymce/imagetoolsplugin/CropRect"],function(t,e,a,n,r,i){return t.extend({Defaults:{classes:"imagepanel"},selection:function(t){return arguments.length?(this.state.set("rect",t),this):this.state.get("rect")},imageSize:function(){var t=this.state.get("viewRect");return{w:t.w,h:t.h}},toggleCropRect:function(t){this.state.set("cropEnabled",t)},imageSrc:function(t){var o=this,i=new Image;i.src=t,function(n){return new r(function(e){n.complete?e(n):n.addEventListener("load",function t(){n.removeEventListener("load",t),e(n)})})}(i).then(function(){var t,e,n=o.state.get("viewRect");(e=o.$el.find("img"))[0]?e.replaceWith(i):o.getEl().appendChild(i),t={x:0,y:0,w:i.naturalWidth,h:i.naturalHeight},o.state.set("viewRect",t),o.state.set("rect",a.inflate(t,-20,-20)),n&&n.w==t.w&&n.h==t.h||o.zoomFit(),o.repaintImage(),o.fire("load")})},zoom:function(t){return arguments.length?(this.state.set("zoom",t),this):this.state.get("zoom")},postRender:function(){return this.imageSrc(this.settings.imageSrc),this._super()},zoomFit:function(){var t,e,n,o,i,a;t=this.$el.find("img"),e=this.getEl().clientWidth,n=this.getEl().clientHeight,o=t[0].naturalWidth,i=t[0].naturalHeight,1<=(a=Math.min((e-10)/o,(n-10)/i))&&(a=1),this.zoom(a)},repaintImage:function(){var t,e,n,o,i,a,r,c,l,u;u=this.getEl(),c=this.zoom(),l=this.state.get("rect"),r=this.$el.find("img"),i=u.offsetWidth,a=u.offsetHeight,n=r[0].naturalWidth*c,o=r[0].naturalHeight*c,t=Math.max(0,i/2-n/2),e=Math.max(0,a/2-o/2),r.css({left:t,top:e,width:n,height:o}),this.cropRect&&(this.cropRect.setRect({x:l.x*c+t,y:l.y*c+e,w:l.w*c,h:l.h*c}),this.cropRect.setClampRect({x:t,y:e,w:n,h:o}),this.cropRect.setViewPortRect({x:0,y:0,w:i,h:a}))},bindStates:function(){var o=this;o.state.on("change:cropEnabled",function(t){o.cropRect.toggleVisibility(t.value),o.repaintImage()}),o.state.on("change:zoom",function(){o.repaintImage()}),o.state.on("change:rect",function(t){var e=t.value;o.cropRect||function(t){o.cropRect=new i(t,o.state.get("viewRect"),o.state.get("viewRect"),o.getEl()),o.cropRect.on("updateRect",function(t){var e=t.rect,n=o.zoom();e={x:Math.round(e.x/n),y:Math.round(e.y/n),w:Math.round(e.w/n),h:Math.round(e.h/n)},o.state.set("rect",e)}),o.on("remove",o.cropRect.destroy)}(e),o.cropRect.setRect(e)})}})}),t("tinymce/imagetoolsplugin/ColorMatrix",[],function(){function c(t,e,n){return n<(t=parseFloat(t))?t=n:t<e&&(t=e),t}function l(t,e){var n,o,i,a,r=[],c=new Array(10);for(n=0;n<5;n++){for(o=0;o<5;o++)r[o]=e[o+5*n];for(o=0;o<5;o++){for(i=a=0;i<5;i++)a+=t[o+5*i]*r[i];c[o+5*n]=a}}return c}function n(t,n){return n=c(n,0,1),t.map(function(t,e){return e%6==0?t=1-(1-t)*n:t*=n,c(t,0,1)})}var o=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10];return{identity:function(){return[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]},adjust:n,multiply:l,adjustContrast:function(t,e){var n;return e=c(e,-1,1),l(t,[(n=(e*=100)<0?127+e/100*127:127*(n=0==(n=e%1)?o[e]:o[Math.floor(e)]*(1-n)+o[Math.floor(e)+1]*n)+127)/127,0,0,0,.5*(127-n),0,n/127,0,0,.5*(127-n),0,0,n/127,0,.5*(127-n),0,0,0,1,0,0,0,0,0,1])},adjustBrightness:function(t,e){return l(t,[1,0,0,0,e=c(255*e,-255,255),0,1,0,0,e,0,0,1,0,e,0,0,0,1,0,0,0,0,0,1])},adjustSaturation:function(t,e){var n;return l(t,[.3086*(1-(n=1+(0<(e=c(e,-1,1))?3*e:e)))+n,.6094*(1-n),.082*(1-n),0,0,.3086*(1-n),.6094*(1-n)+n,.082*(1-n),0,0,.3086*(1-n),.6094*(1-n),.082*(1-n)+n,0,0,0,0,0,1,0,0,0,0,0,1])},adjustHue:function(t,e){var n,o,i,a,r;return e=c(e,-180,180)/180*Math.PI,l(t,[(i=.213)+.787*(n=Math.cos(e))+(o=Math.sin(e))*-i,(a=.715)+n*-a+o*-a,(r=.072)+n*-r+.928*o,0,0,i+n*-i+.143*o,a+n*(1-a)+.14*o,r+n*-r+-.283*o,0,0,i+n*-i+-.787*o,a+n*-a+o*a,r+.928*n+o*r,0,0,0,0,0,1,0,0,0,0,0,1])},adjustColors:function(t,e,n,o){return l(t,[e=c(e,0,2),0,0,0,0,0,n=c(n,0,2),0,0,0,0,0,o=c(o,0,2),0,0,0,0,0,1,0,0,0,0,0,1])},adjustSepia:function(t,e){return l(t,n([.393,.769,.189,0,0,.349,.686,.168,0,0,.272,.534,.131,0,0,0,0,0,1,0,0,0,0,0,1],e=c(e,0,1)))},adjustGrayscale:function(t,e){return l(t,n([.33,.34,.33,0,0,.33,.34,.33,0,0,.33,.34,.33,0,0,0,0,0,1,0,0,0,0,0,1],e=c(e,0,1)))}}}),t("tinymce/imagetoolsplugin/Filters",["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ColorMatrix"],function(l,u,s,i){function a(t,i){return s.blobToImage(t).then(function(t){var e,n=l.create(u.getWidth(t),u.getHeight(t)),o=l.get2dContext(n);return o.drawImage(t,0,0),d(t),e=function(t,e){var n,o,i,a,r,c=t.data,l=e[0],u=e[1],s=e[2],d=e[3],g=e[4],m=e[5],f=e[6],h=e[7],p=e[8],y=e[9],v=e[10],b=e[11],w=e[12],x=e[13],k=e[14],I=e[15],R=e[16],C=e[17],M=e[18],T=e[19];for(r=0;r<c.length;r+=4)n=c[r],o=c[r+1],i=c[r+2],a=c[r+3],c[r]=n*l+o*u+i*s+a*d+g,c[r+1]=n*m+o*f+i*h+a*p+y,c[r+2]=n*v+o*b+i*w+a*x+k,c[r+3]=n*I+o*R+i*C+a*M+T;return t}(o.getImageData(0,0,n.width,n.height),i),o.putImageData(e,0,0),s.canvasToBlob(n)})}function n(t,i){return s.blobToImage(t).then(function(t){var e,n=l.create(u.getWidth(t),u.getHeight(t)),o=l.get2dContext(n);return o.drawImage(t,0,0),d(t),e=function(t,e,n){function o(t,e,n){return n<t?t=n:t<e&&(t=e),t}var i,a,r,c,l,u,s,d,g,m,f,h,p,y,v,b;for(r=Math.round(Math.sqrt(n.length)),c=Math.floor(r/2),i=t.data,a=e.data,v=t.width,b=t.height,u=0;u<b;u++)for(l=0;l<v;l++){for(s=d=g=0,f=0;f<r;f++)for(m=0;m<r;m++)h=o(l+m-c,0,v-1),p=4*(o(u+f-c,0,b-1)*v+h),y=n[f*r+m],s+=i[p]*y,d+=i[p+1]*y,g+=i[p+2]*y;a[p=4*(u*v+l)]=o(s,0,255),a[p+1]=o(d,0,255),a[p+2]=o(g,0,255)}return e}(o.getImageData(0,0,n.width,n.height),e=o.getImageData(0,0,n.width,n.height),i),o.putImageData(e,0,0),s.canvasToBlob(n)})}function t(c){return function(t,r){return s.blobToImage(t).then(function(t){var e,n,o=l.create(u.getWidth(t),u.getHeight(t)),i=l.get2dContext(o),a=new Array(256);for(n=0;n<a.length;n++)a[n]=c(n,r);return i.drawImage(t,0,0),d(t),e=function(t,e){var n,o=t.data;for(n=0;n<o.length;n+=4)o[n]=e[o[n]],o[n+1]=e[o[n+1]],o[n+2]=e[o[n+2]];return t}(i.getImageData(0,0,o.width,o.height),a),i.putImageData(e,0,0),s.canvasToBlob(o)})}}function e(n){return function(t,e){return a(t,n(i.identity(),e))}}function o(e){return function(t){return n(t,e)}}var r,d=s.revokeImageUrl;return{invert:(r=[-1,0,0,0,255,0,-1,0,0,255,0,0,-1,0,255,0,0,0,1,0],function(t){return a(t,r)}),brightness:e(i.adjustBrightness),hue:e(i.adjustHue),saturate:e(i.adjustSaturation),contrast:e(i.adjustContrast),grayscale:e(i.adjustGrayscale),sepia:e(i.adjustSepia),colorize:function(t,e,n,o){return a(t,i.adjustColors(i.identity(),e,n,o))},sharpen:o([0,-1,0,-1,5,-1,0,-1,0]),emboss:o([-2,-1,0,-1,1,1,0,1,2]),gamma:t(function(t,e){return 255*Math.pow(t/255,1-e)}),exposure:t(function(t,e){return 255*(1-Math.exp(-t/255*e))}),colorFilter:a,convoluteFilter:n}}),t("tinymce/imagetoolsplugin/UndoStack",[],function(){return function(){function t(){return 0<o}function e(){return-1!=o&&o<n.length-1}var n=[],o=-1;return{data:n,add:function(t){var e;return e=n.splice(++o),n.push(t),{state:t,removed:e}},undo:function(){return t()?n[--o]:void 0},redo:function(){return e()?n[++o]:void 0},canUndo:t,canRedo:e}}}),t("tinymce/imagetoolsplugin/Dialog",["tinymce/dom/DOMUtils","tinymce/util/Tools","tinymce/util/Promise","tinymce/ui/Factory","tinymce/ui/Form","tinymce/ui/Container","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/UndoStack"],function(G,q,t,K,Z,N,Q,J,tt,e,et){function nt(t){return{blob:t,url:URL.createObjectURL(t)}}function ot(t){t&&URL.revokeObjectURL(t.url)}function it(t){q.each(t,ot)}function o(a,t,e){function n(t){var e,n,o,i;e=y.find("#w")[0],n=y.find("#h")[0],o=parseInt(e.value(),10),i=parseInt(n.value(),10),y.find("#constrain")[0].checked()&&O&&P&&o&&i&&("w"==t.control.settings.name?(i=Math.round(o*V),n.value(i)):(o=Math.round(i*X),e.value(o))),O=o,P=i}function r(t){return Math.round(100*t)+"%"}function o(){y.find("#undo").disabled(!Y.canUndo()),y.find("#redo").disabled(!Y.canRedo()),y.statusbar.find("#save").disabled(!Y.canUndo())}function c(){y.find("#undo").disabled(!0),y.find("#redo").disabled(!0)}function l(t){t&&R.imageSrc(t.url)}function i(e){return function(){var t=q.grep(A,function(t){return t.settings.name!=e});q.each(t,function(t){t.hide()}),e.show()}}function u(t){l(w=nt(t))}function s(t){l(a=nt(t)),it(Y.add(a).removed),o()}function d(e){var n=[].slice.call(arguments,1);return function(){var t=w||a;e.apply(this,[t.blob].concat(n)).then(u)}}function g(){l(a),ot(w),i(v)(),o()}function m(){w&&(s(w.blob),g())}function f(t){return new Z({layout:"flex",direction:"row",labelGap:5,border:"0 0 1 0",align:"center",pack:"center",padding:"0 10 0 10",spacing:5,flex:0,minHeight:60,defaults:{classes:"imagetool",type:"button"},items:t})}function h(t,e){return f([{text:"Back",onclick:g},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:m}]).hide().on("show",function(){c(),e(a.blob).then(function(t){var e=nt(t);l(e),ot(w),w=e})})}function p(t,e,n,o,i){return f([{text:"Back",onclick:g},{type:"spacer",flex:1},{type:"slider",flex:1,ondragend:function(t){!function(t){e(a.blob,t).then(function(t){var e=nt(t);l(e),ot(w),w=e})}(t.value)},minValue:o,maxValue:i,value:n,previewFilter:r},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:m}]).hide().on("show",function(){this.find("slider").value(n),c()})}var y,v,b,w,x,k,I,R,C,M,T,B,U,z,H,j,D,S,W,L,E,F,A,O,P,V,X,$,Y=new et;function _(){var t,e,n;t=y.find("#r")[0].value(),e=y.find("#g")[0].value(),n=y.find("#b")[0].value(),$(a.blob,t,e,n).then(function(t){var e=nt(t);l(e),ot(w),w=e})}x=f([{text:"Back",onclick:g},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:function(){var t=R.selection();J.crop(a.blob,t.x,t.y,t.w,t.h).then(function(t){s(t),g()})}}]).hide().on("show hide",function(t){R.toggleCropRect("show"==t.type)}).on("show",c),k=f([{text:"Back",onclick:g},{type:"spacer",flex:1},{type:"textbox",name:"w",label:"Width",size:4,onkeyup:n},{type:"textbox",name:"h",label:"Height",size:4,onkeyup:n},{type:"checkbox",name:"constrain",text:"Constrain proportions",checked:!0,onchange:function(t){!0===t.control.value()&&(V=P/O,X=O/P)}},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:"submit"}]).hide().on("submit",function(t){var e=parseInt(y.find("#w").value(),10),n=parseInt(y.find("#h").value(),10);t.preventDefault(),function(t){var e=[].slice.call(arguments,1);return function(){t.apply(this,[a.blob].concat(e)).then(s)}}(J.resize,e,n)(),g()}).on("show",c),I=f([{text:"Back",onclick:g},{type:"spacer",flex:1},{icon:"fliph",tooltip:"Flip horizontally",onclick:d(J.flip,"h")},{icon:"flipv",tooltip:"Flip vertically",onclick:d(J.flip,"v")},{icon:"rotateleft",tooltip:"Rotate counterclockwise",onclick:d(J.rotate,-90)},{icon:"rotateright",tooltip:"Rotate clockwise",onclick:d(J.rotate,90)},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:m}]).hide().on("show",c),T=h(0,tt.invert),W=h(0,tt.sharpen),L=h(0,tt.emboss),B=p(0,tt.brightness,0,-1,1),U=p(0,tt.hue,180,0,360),z=p(0,tt.saturate,0,-1,1),H=p(0,tt.contrast,0,-1,1),j=p(0,tt.grayscale,0,0,1),D=p(0,tt.sepia,0,0,1),$=tt.colorize,S=f([{text:"Back",onclick:g},{type:"spacer",flex:1},{type:"slider",label:"R",name:"r",minValue:0,value:1,maxValue:2,ondragend:_,previewFilter:r},{type:"slider",label:"G",name:"g",minValue:0,value:1,maxValue:2,ondragend:_,previewFilter:r},{type:"slider",label:"B",name:"b",minValue:0,value:1,maxValue:2,ondragend:_,previewFilter:r},{type:"spacer",flex:1},{text:"Apply",subtype:"primary",onclick:m}]).hide().on("show",function(){y.find("#r,#g,#b").value(1),c()}),E=p(0,tt.gamma,0,-1,1),F=p(0,tt.exposure,1,0,2),b=f([{text:"Back",onclick:g},{type:"spacer",flex:1},{text:"hue",icon:"hue",onclick:i(U)},{text:"saturate",icon:"saturate",onclick:i(z)},{text:"sepia",icon:"sepia",onclick:i(D)},{text:"emboss",icon:"emboss",onclick:i(L)},{text:"exposure",icon:"exposure",onclick:i(F)},{type:"spacer",flex:1}]).hide(),v=f([{tooltip:"Crop",icon:"crop",onclick:i(x)},{tooltip:"Resize",icon:"resize2",onclick:i(k)},{tooltip:"Orientation",icon:"orientation",onclick:i(I)},{tooltip:"Brightness",icon:"sun",onclick:i(B)},{tooltip:"Sharpen",icon:"sharpen",onclick:i(W)},{tooltip:"Contrast",icon:"contrast",onclick:i(H)},{tooltip:"Color levels",icon:"drop",onclick:i(S)},{tooltip:"Gamma",icon:"gamma",onclick:i(E)},{tooltip:"Invert",icon:"invert",onclick:i(T)}]),R=new Q({flex:1,imageSrc:a.url}),C=new N({layout:"flex",direction:"column",border:"0 1 0 0",padding:5,spacing:5,items:[{type:"button",icon:"undo",tooltip:"Undo",name:"undo",onclick:function(){l(a=Y.undo()),o()}},{type:"button",icon:"redo",tooltip:"Redo",name:"redo",onclick:function(){l(a=Y.redo()),o()}},{type:"button",icon:"zoomin",tooltip:"Zoom in",onclick:function(){var t=R.zoom();t<2&&(t+=.1),R.zoom(t)}},{type:"button",icon:"zoomout",tooltip:"Zoom out",onclick:function(){var t=R.zoom();.1<t&&(t-=.1),R.zoom(t)}}]}),M=new N({type:"container",layout:"flex",direction:"row",align:"stretch",flex:1,items:[C,R]}),A=[v,x,k,I,b,T,B,U,z,H,j,D,S,W,L,E,F],(y=K.create("window",{layout:"flex",direction:"column",align:"stretch",minWidth:Math.min(G.DOM.getViewPort().w,800),minHeight:Math.min(G.DOM.getViewPort().h,650),title:"Edit image",items:A.concat([M]),buttons:[{text:"Save",name:"save",subtype:"primary",onclick:function(){t(a.blob),y.close()}},{text:"Cancel",onclick:"close"}]})).renderTo(document.body).reflow(),y.on("close",function(){e(),it(Y.data),w=Y=null}),Y.add(a),o(),R.on("load",function(){O=R.imageSize().w,P=R.imageSize().h,V=P/O,X=O/P,y.find("#w").value(O),y.find("#h").value(P)})}return{edit:function(n){return new t(function(t,e){o(nt(n),t,e)})}}}),t("tinymce/imagetoolsplugin/Plugin",["tinymce/PluginManager","tinymce/Env","tinymce/util/Promise","tinymce/util/URI","tinymce/util/Tools","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/Dialog"],function(t,v,b,w,x,k,I,R){t.add("imagetools",function(c){function r(t){function e(t){return t.indexOf("px")==t.length-2}var n,o;return n=t.style.width,o=t.style.height,n||o?e(n)&&e(o)?{w:parseInt(n,10),h:parseInt(o,10)}:null:(n=c.$(t).attr("width"),o=c.$(t).attr("height"),n&&o?{w:parseInt(n,10),h:parseInt(o,10)}:null)}function l(t,e){var n,o;e&&(n=t.style.width,o=t.style.height,(n||o)&&c.$(t).css({width:e.w,height:e.h}).removeAttr("data-mce-style"),n=t.width,o=t.height,(n||o)&&c.$(t).attr({width:e.w,height:e.h}))}function u(t){return{w:t.naturalWidth,h:t.naturalHeight}}function s(){return c.selection.getNode()}function d(){return"imagetools"+y++}function n(t){var e=t.src;return 0===e.indexOf("data:")||0===e.indexOf("blob:")||new w(e).host===c.documentBaseURI.host}function o(t){return-1!==x.inArray(c.settings.imagetools_cors_hosts,new w(t.src).host)}function t(t){var e=t.src;return o(t)?function(n){return new b(function(t){var e=new XMLHttpRequest;e.onload=function(){t(this.response)},e.open("GET",n,!0),e.responseType="blob",e.send()})}(t.src):(n(t)||(t=new Image,e=c.settings.imagetools_proxy,t.src+=(-1===e.indexOf("?")?"?":"&")+"url="+encodeURIComponent(t.src)),I.imageToBlob(t))}function e(){return c.editorUpload.blobCache.getByUri(s().src)||t(s()).then(function(o){return I.blobToBase64(o).then(function(t){var e=c.editorUpload.blobCache,n=e.create(d(),o,t);return e.add(n),n})})}function g(r){return I.blobToDataUri(r).then(function(t){var e,n,o,i,a;return a=s(),e=d(),o=c.editorUpload.blobCache,n=w.parseDataUri(t).data,i=o.create(e,r,n),o.add(i),c.undoManager.transact(function(){c.$(a).on("load",function t(){c.$(a).off("load",t),c.nodeChanged()}),c.$(a).attr({src:i.blobUri()}).removeAttr("data-mce-src")}),i})}function i(t){return function(){return c._scanForImages().then(e).then(t).then(g)}}function a(n){return function(){return i(function(t){var e=r(s());return e&&l(s(),{w:e.h,h:e.w}),k.rotate(t.blob(),n)})()}}function m(e){return function(){return i(function(t){return k.flip(t.blob(),e)})()}}function f(){var i=s(),a=u(i);i&&t(i).then(R.edit).then(function(o){return new b(function(n){I.blobToImage(o).then(function(t){var e=u(t);a.w==e.w&&a.h==e.h||!r(i)||l(i,e),URL.revokeObjectURL(t.src),n(o)})})}).then(g,function(){})}function h(t){return c.dom.is(t,"img:not([data-mce-object],[data-mce-placeholder])")&&(n(t)||o(t)||c.settings.imagetools_proxy)}var p,y=0;v.fileApi&&(c.addButton("rotateleft",{title:"Rotate counterclockwise",onclick:a(-90)}),c.addButton("rotateright",{title:"Rotate clockwise",onclick:a(90)}),c.addButton("flipv",{title:"Flip vertically",onclick:m("v")}),c.addButton("fliph",{title:"Flip horizontally",onclick:m("h")}),c.addButton("editimage",{title:"Edit image",onclick:f}),c.addButton("imageoptions",{title:"Image options",icon:"options",cmd:"mceImage"}),(p=c.settings.imagetools_toolbar)||(p="rotateleft rotateright | flipv fliph | crop editimage imageoptions"),c.addContextToolbar(h,p))})}),function(t){var e,n,o,i,a;for(e=0;e<t.length;e++){n=c,i=(o=t[e]).split(/[.\/]/);for(var r=0;r<i.length-1;++r)n[i[r]]===l&&(n[i[r]]={}),n=n[i[r]];n[i[i.length-1]]=u[o]}if(c.AMDLC_TESTS){for(o in a=c.privateModules||{},u)a[o]=u[o];for(e=0;e<t.length;e++)delete a[t[e]];c.privateModules=a}}(["tinymce/imagetoolsplugin/Canvas","tinymce/imagetoolsplugin/Mime","tinymce/imagetoolsplugin/ImageSize","tinymce/imagetoolsplugin/Conversions","tinymce/imagetoolsplugin/ImageTools","tinymce/imagetoolsplugin/CropRect","tinymce/imagetoolsplugin/ImagePanel","tinymce/imagetoolsplugin/ColorMatrix","tinymce/imagetoolsplugin/Filters","tinymce/imagetoolsplugin/UndoStack","tinymce/imagetoolsplugin/Dialog","tinymce/imagetoolsplugin/Plugin"])}(this);