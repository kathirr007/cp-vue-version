tinymce.PluginManager.add("noneditable",function(N){function S(e){var t;if(1===e.nodeType){if((t=e.getAttribute(l))&&"inherit"!==t)return t;if("inherit"!==(t=e.contentEditable))return t}return null}function A(e){for(var t;e;){if(t=S(e))return"false"===t?e:null;e=e.parentNode}}function e(e){var t=o.length,r=e.content,a=tinymce.trim(i);if("raw"!=e.format){for(;t--;)r=r.replace(o[t],function(e){var t=arguments,n=t[t.length-2];return 0<n&&'"'==r.charAt(n-1)?e:'<span class="'+a+'" data-mce-content="'+N.dom.encode(t[0])+'">'+N.dom.encode("string"==typeof t[1]?t[1]:t[0])+"</span>"});e.content=r}}var a,i,o,B=tinymce.dom.TreeWalker,r="contenteditable",l="data-mce-"+r,P=tinymce.util.VK;a=" "+tinymce.trim(N.getParam("noneditable_editable_class","mceEditable"))+" ",i=" "+tinymce.trim(N.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",(o=N.getParam("noneditable_regexp"))&&!o.length&&(o=[o]),N.on("PreInit",function(){(function(){function T(e){for(;e;){if(e.id===o)return e;e=e.parentNode}}function a(e){var t;if(e)for(e=(t=new B(e,e)).current();e;e=t.next())if(3===e.nodeType)return e}function i(e,t){var n,r;return"false"===S(e)&&C.isBlock(e)?void y.select(e):(r=C.createRng(),"true"===S(e)&&(e.firstChild||e.appendChild(N.getDoc().createTextNode("Â ")),e=e.firstChild,t=!0),n=C.create("span",{id:o,"data-mce-bogus":!0},l),t?e.parentNode.insertBefore(n,e):C.insertAfter(n,e),r.setStart(n.firstChild,1),r.collapse(!0),y.setRng(r),n)}function h(e){var t,n,r;if(e)(t=y.getRng(!0)).setStartBefore(e),t.setEndBefore(e),(n=a(e))&&n.nodeValue.charAt(0)==l&&(n=n.deleteData(0,1)),C.remove(e,!0),y.setRng(t);else for(;(e=C.get(o))&&e!==r;)(n=a(e))&&n.nodeValue.charAt(0)==l&&(n=n.deleteData(0,1)),C.remove(e,!0),r=e}function b(){function e(e,t){var n,r,a,i,o;if(n=f.startContainer,r=f.startOffset,3==n.nodeType){if(o=n.nodeValue.length,0<r&&r<o||(t?r==o:0===r))return}else{if(!(r<n.childNodes.length))return t?null:e;var l=!t&&0<r?r-1:r;(n=n.childNodes[l]).hasChildNodes()&&(n=n.firstChild)}for(a=new B(n,e);i=a[t?"prev":"next"]();){if(3===i.nodeType&&0<i.nodeValue.length)return;if("true"===S(i))return i}return e}var t,n,r,f,a;h(),r=y.isCollapsed(),t=A(y.getStart()),n=A(y.getEnd()),(t||n)&&(f=y.getRng(!0),r?(a=e(t=t||n,!0))?i(a,!0):(a=e(t,!1))?i(a,!1):y.select(t):(f=y.getRng(!0),t&&f.setStartBefore(t),n&&f.setEndAfter(n),y.setRng(f)))}var C=N.dom,y=N.selection,o="mce_noneditablecaret",l="\ufeff";N.on("mousedown",function(e){var t=N.selection.getNode();t&&-1!==t.className.indexOf("mceTmpParagraph")&&t!==e.target&&("&nbsp;"===t.innerHTML||""===t.innerHTML||" "===t.innerHTML?C.remove(t):t.className=t.className.replace("mceTmpParagraph","")),"false"===S(t)&&t==e.target&&b()}),N.on("mouseup",b),N.on("keydown",function(e){function t(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||0<e.nodeValue.length)return e}function n(e,t){y.select(e),y.collapse(t)}var r,a,i,o,l=e.keyCode;b(),i=y.getStart(),o=y.getEnd(),r=A(i)||A(o);var f=N.selection.getNode(),s=l==P.LEFT||l==P.RIGHT||l==P.UP||l==P.DOWN,c=l==P.LEFT||l==P.UP;if(r&&(l<112||124<l)&&l!=P.DELETE&&l!=P.BACKSPACE){if((tinymce.isMac?e.metaKey:e.ctrlKey)&&(67==l||88==l||86==l))return;if(e.preventDefault(),s)if(N.dom.isBlock(r)){var d=c?r.previousSibling:r.nextSibling;if(!d||d&&"false"===S(d)){var u=C.create("p",null,"&nbsp;");u.className="mceTmpParagraph";var m=c?r:d;m&&m.parentNode?m.parentNode.insertBefore(u,m):d||c||r.parentNode.appendChild(u),d=u}var p=new B(d,d);n(c?p.prev():p.next(),!c)}else n(r,c)}else if(s||l==P.BACKSPACE||l==P.DELETE){if(a=T(i)){if(l==P.LEFT||l==P.BACKSPACE)if((r=t(a,!0))&&"false"===S(r)){if(e.preventDefault(),l!=P.LEFT)return void C.remove(r);n(r,!0)}else h(a);if(l==P.RIGHT||l==P.DELETE)if((r=t(a,!0))&&"false"===S(r)){if(e.preventDefault(),l!=P.RIGHT)return void C.remove(r);n(r,!1)}else h(a)}else{if(s&&f&&-1!==f.className.indexOf("mceTmpParagraph")&&f[c?"previousSibling":"nextSibling"]){var g=f[c?"previousSibling":"nextSibling"];"&nbsp;"===f.innerHTML||""===f.innerHTML||" "===f.innerHTML?C.remove(f):f.className=f.className.replace("mceTmpParagraph",""),n(g,!c)}var v=y.getRng(!0),E=v.endContainer;if(C.isBlock(E)&&C.isBlock(E.nextSibling)&&1==v.endOffset&&l==P.DELETE&&(r=A(E.nextSibling)),r&&(l==P.DELETE||l==P.BACKSPACE)&&C.isBlock(r))return e.preventDefault(),void C.remove(r)}if((l==P.BACKSPACE||l==P.DELETE)&&!function(r){function a(e){for(var t=i;t;){if(t===e)return;t=t.parentNode}C.remove(e),b()}var e,i,t,n;if(y.isCollapsed()){if(e=y.getRng(!0),i=e.startContainer,t=e.startOffset,n=A(i=T(i)||i))return a(n),!1;if(3==i.nodeType&&(r?0<t:t<i.nodeValue.length))return!0;if(1==i.nodeType&&(i=i.childNodes[t]||i),function(){var e,t,n=N.schema.getNonEmptyElements();for(t=new tinymce.dom.TreeWalker(i,N.getBody());(e=r?t.prev():t.next())&&!n[e.nodeName.toLowerCase()]&&!(3===e.nodeType&&0<tinymce.trim(e.nodeValue).length);)if("false"===S(e))return a(e),!0;return!!A(e)}())return!1}return!0}(l==P.BACKSPACE))return e.preventDefault(),!1}})})(),o&&N.on("BeforeSetContent",e),N.parser.addAttributeFilter("class",function(e){for(var t,n,r=e.length;r--;)-1!==(t=" "+(n=e[r]).attr("class")+" ").indexOf(a)?n.attr(l,"true"):-1!==t.indexOf(i)&&n.attr(l,"false")}),N.serializer.addAttributeFilter(l,function(e){for(var t,n=e.length;n--;)t=e[n],o&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(r,null),t.attr(l,null))}),N.parser.addAttributeFilter(r,function(e){for(var t,n=e.length;n--;)(t=e[n]).attr(l,t.attr(r)),t.attr(r,null)})}),N.on("drop",function(e){A(e.target)&&e.preventDefault()})});