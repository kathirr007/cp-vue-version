tinymce.PluginManager.add("importcss",function(m){function n(e){return"string"==typeof e?function(t){return-1!==t.indexOf(e)}:e instanceof RegExp?function(t){return e.test(t)}:e}function i(t,s){var c=[],n={};p(m.contentCSS,function(t){n[t]=!0}),s||(s=function(t,e){return e||n[t]});try{p(t.styleSheets,function(t){!function e(t,n){var i,r=t.href;if(r&&s(r,n)){p(t.imports,function(t){e(t,!0)});try{i=t.cssRules||t.rules}catch(t){}p(i,function(t){t.styleSheet?e(t.styleSheet,!0):t.selectorText&&p(t.selectorText.split(","),function(t){c.push(tinymce.trim(t))})})}}(t)})}catch(t){}return c}function r(t){var e,n=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(n){var i=n[1],r=n[2].substr(1).split(".").join(" "),s=tinymce.makeMap("a,img");return n[1]?(e={title:t},m.schema.getTextBlockElements()[i]?e.block=i:m.schema.getBlockElements()[i]||s[i.toLowerCase()]?e.selector=i:e.inline=i):n[2]&&(e={inline:"span",title:t.substr(1),classes:r}),!1!==m.settings.importcss_merge_classes?e.classes=r:e.attributes={class:r},e}}var u=this,p=tinymce.each;m.on("renderFormatsMenu",function(t){var e=m.settings,c={},o=e.importcss_selector_converter||r,a=n(e.importcss_selector_filter),l=t.control;m.settings.importcss_append||l.items().remove();var f=[];tinymce.each(e.importcss_groups,function(t){(t=tinymce.extend({},t)).filter=n(t.filter),f.push(t)}),p(i(t.doc||m.getDoc(),n(e.importcss_file_filter)),function(t){if(-1===t.indexOf(".mce-")&&!c[t]&&(!a||a(t))){var e,n=o.call(u,t);if(n){var i=n.name||tinymce.DOM.uniqueId();if(f)for(var r=0;r<f.length;r++)if(!f[r].filter||f[r].filter(t)){f[r].item||(f[r].item={text:f[r].title,menu:[]}),e=f[r].item.menu;break}m.formatter.register(i,n);var s=tinymce.extend({},l.settings.itemDefaults,{text:n.title,format:i});e?e.push(s):l.add(s)}c[t]=!0}}),p(f,function(t){l.add(t.item)}),t.control.renderNew()}),u.convertSelectorToFormat=r});