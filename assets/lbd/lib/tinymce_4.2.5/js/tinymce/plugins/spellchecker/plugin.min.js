!function(a,l){"use strict";function e(e,t,n){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(t===l)throw"invalid module definition, dependencies must be specified";if(n===l)throw"invalid module definition, definition function must be specified";!function(e,t){for(var n,r=[],o=0;o<e.length;++o){if(!(n=s[e[o]]||i(e[o])))throw"module definition dependecy not found: "+e[o];r.push(n)}t.apply(null,r)}(t,function(){s[e]=n.apply(null,arguments)})}function i(e){for(var t=a,n=e.split(/[.\/]/),r=0;r<n.length;++r){if(!t[n[r]])return;t=t[n[r]]}return t}var s={};e("tinymce/spellcheckerplugin/DomTextMatcher",[],function(){return function(c,r){function n(e,t){if(!e[0])throw"findAndReplaceDOMText cannot handle zero-length matches";return{start:e.index,end:e.index+e[0].length,text:e[0],data:t}}function o(e){var t=c.getElementsByTagName("*"),n=[];e="number"==typeof e?""+e:null;for(var r=0;r<t.length;r++){var o=t[r],i=o.getAttribute("data-mce-index");null===i||!i.length||i!==e&&null!==e||n.push(o)}return n}function i(e){for(var t=d.length;t--;)if(d[t]===e)return t;return-1}function e(e){for(var t=0,n=d.length;t<n&&!1!==e(d[t],t);t++);return this}function t(e){var t,n,r=o(e?i(e):null);for(t=r.length;t--;)(n=r[t]).parentNode.insertBefore(n.firstChild,n),n.parentNode.removeChild(n);return this}function a(e){var t=o(i(e)),n=r.dom.createRng();return n.setStartBefore(t[0]),n.setEndAfter(t[t.length-1]),n}var l,s,f,h,p,d=[],x=r.dom;return f=r.schema.getBlockElements(),h=r.schema.getWhiteSpaceElements(),p=r.schema.getShortEndedElements(),{text:s=function e(t){var n;if(3===t.nodeType)return t.data;if(h[t.nodeName]&&!f[t.nodeName])return"";if(n="",(f[t.nodeName]||p[t.nodeName])&&(n+="\n"),t=t.firstChild)for(;n+=e(t),t=t.nextSibling;);return n}(c),matches:d,each:e,filter:function(n){var r=[];return e(function(e,t){n(e,t)&&r.push(e)}),d=r,this},reset:function(){return d.splice(0,d.length),t(),this},matchFromElement:function(e){return d[e.getAttribute("data-mce-index")]},elementFromMatch:function(e){return o(i(e))[0]},find:function(e,t){if(s&&e.global)for(;l=e.exec(s);)d.push(n(l,t));return this},add:function(e,t,n){return d.push({start:e,end:e+t,text:s.substr(e,t),data:n}),this},wrap:function(e){return d.length&&function(e,t,n){var r,o,i,c,a,l=[],s=0,d=e,u=0;(t=t.slice(0)).sort(function(e,t){return e.start-t.start}),a=t.shift();e:for(;;){if((f[d.nodeName]||p[d.nodeName])&&s++,3===d.nodeType&&(!o&&d.length+s>=a.end?(o=d,c=a.end-s):r&&l.push(d),!r&&d.length+s>a.start&&(r=d,i=a.start-s),s+=d.length),r&&o){if(d=n({startNode:r,startNodeIndex:i,endNode:o,endNodeIndex:c,innerNodes:l,match:a.text,matchIndex:u}),s-=o.length-c,o=r=null,l=[],u++,!(a=t.shift()))break}else{if((!h[d.nodeName]||f[d.nodeName])&&d.firstChild){d=d.firstChild;continue}if(d.nextSibling){d=d.nextSibling;continue}}for(;;){if(d.nextSibling){d=d.nextSibling;break}if(d.parentNode===e)break e;d=d.parentNode}}}(c,d,function(o){function v(e,t){var n=d[t];n.stencil||(n.stencil=o(n));var r=n.stencil.cloneNode(!1);return r.setAttribute("data-mce-index",t),e&&r.appendChild(x.doc.createTextNode(e)),r}return function(e){var t,n,r,o=e.startNode,i=e.endNode,c=e.matchIndex,a=x.doc;if(o===i){var l=o;r=l.parentNode,0<e.startNodeIndex&&(t=a.createTextNode(l.data.substring(0,e.startNodeIndex)),r.insertBefore(t,l));var s=v(e.match,c);return r.insertBefore(s,l),e.endNodeIndex<l.length&&(n=a.createTextNode(l.data.substring(e.endNodeIndex)),r.insertBefore(n,l)),l.parentNode.removeChild(l),s}t=a.createTextNode(o.data.substring(0,e.startNodeIndex)),n=a.createTextNode(i.data.substring(e.endNodeIndex));for(var d=v(o.data.substring(e.startNodeIndex),c),u=[],f=0,h=e.innerNodes.length;f<h;++f){var p=e.innerNodes[f],g=v(p.data,c);p.parentNode.replaceChild(g,p),u.push(g)}var m=v(i.data.substring(0,e.endNodeIndex),c);return(r=o.parentNode).insertBefore(t,o),r.insertBefore(d,o),r.removeChild(o),(r=i.parentNode).insertBefore(m,i),r.insertBefore(n,i),r.removeChild(i),m}}(e)),this},unwrap:t,replace:function(e,t){var n=a(e);return n.deleteContents(),0<t.length&&n.insertNode(r.dom.doc.createTextNode(t)),n},rangeFromMatch:a,indexOf:i}}}),e("tinymce/spellcheckerplugin/Plugin",["tinymce/spellcheckerplugin/DomTextMatcher","tinymce/PluginManager","tinymce/util/Tools","tinymce/ui/Menu","tinymce/dom/DOMUtils","tinymce/util/XHR","tinymce/util/URI","tinymce/util/JSON"],function(b,e,T,M,C,B,E,I){e.add("spellchecker",function(a,c){function n(){return k.textMatcher||(k.textMatcher=new b(a.getBody(),a)),k.textMatcher}function o(e,t){var n=[],r=p[e];T.each(r,function(e){n.push({text:e,onclick:function(){a.insertContent(a.dom.encode(e)),a.dom.remove(t),s()}})}),n.push({text:"-"}),v&&n.push({text:"Add to Dictionary",onclick:function(){!function(e,t){a.setProgressState(!0),l("addToDictionary",e,function(){a.setProgressState(!1),a.dom.remove(t,!0),s()},function(e){a.windowManager.alert(e),a.setProgressState(!1)})}(e,t)}}),n.push.apply(n,[{text:"Ignore",onclick:function(){d(e,t)}},{text:"Ignore all",onclick:function(){d(e,t,!0)}}]),(m=new M({items:n,context:"contextmenu",onautohide:function(e){-1!=e.target.className.indexOf("spellchecker")&&e.preventDefault()},onhide:function(){m.remove(),m=null}})).renderTo(document.body);var o=C.DOM.getPos(a.getContentAreaContainer()),i=a.dom.getPos(t[0]),c=a.dom.getRoot();"BODY"==c.nodeName?(i.x-=c.ownerDocument.documentElement.scrollLeft||c.scrollLeft,i.y-=c.ownerDocument.documentElement.scrollTop||c.scrollTop):(i.x-=c.scrollLeft,i.y-=c.scrollTop),o.x+=i.x,o.y+=i.y,m.moveTo(o.x,o.y+t[0].offsetHeight)}function r(){return a.getParam("spellchecker_wordchar_pattern")||new RegExp('[^\\s!"#$%&()*+,-./:;<=>?@[\\]^_{|}`§©«®±¶·¸»¼½¾¿×÷¤”“„    ]+',"g")}function i(e,t,n,r){var o={method:e},i="";"spellcheck"==e&&(o.text=t,o.lang=y.spellchecker_language),"addToDictionary"==e&&(o.word=t),T.each(o,function(e,t){i&&(i+="&"),i+=t+"="+encodeURIComponent(e)}),B.send({url:new E(c).toAbsolute(y.spellchecker_rpc_url),type:"post",content_type:"application/x-www-form-urlencoded",data:i,success:function(e){(e=I.parse(e))?e.error?r(e.error):n(e):r("Sever response wasn't proper JSON.")},error:function(e,t){r("Spellchecker request error: "+t.status)}})}function l(e,t,n,r){(y.spellchecker_callback||i).call(k,e,t,n,r)}function e(){t(),g||(a.setProgressState(!0),l("spellcheck",n().text,f,function(e){a.windowManager.alert(e),a.setProgressState(!1),t()}),a.focus())}function s(){a.dom.select("span.mce-spellchecker-word").length||t()}function d(t,e,n){a.selection.collapse(),n?T.each(a.dom.select("span.mce-spellchecker-word"),function(e){e.getAttribute("data-mce-word")==t&&a.dom.remove(e,!0)}):a.dom.remove(e,!0),s()}function t(){n().reset(),k.textMatcher=null,g&&(g=!1,a.fire("SpellcheckEnd"))}function u(e){var t=e.getAttribute("data-mce-index");return"number"==typeof t?""+t:t}function f(e){var t;return t=e.words?(v=!!e.dictionary,e.words):e,a.setProgressState(!1),function(e){for(var t in e)return!1;return!0}(t)?(a.windowManager.alert("No misspellings found"),void(g=!1)):(p=t,n().find(r()).filter(function(e){return!!t[e.text]}).wrap(function(e){return a.dom.create("span",{class:"mce-spellchecker-word","data-mce-bogus":1,"data-mce-word":e.text})}),g=!0,void a.fire("SpellcheckStart"))}var h,p,g,m,v,x,N,k=this,y=a.settings,w=y.spellchecker_languages||"English=en,Danish=da,Dutch=nl,Finnish=fi,French=fr_FR,German=de,Italian=it,Polish=pl,Portuguese=pt_BR,Spanish=es,Swedish=sv";x=T.map(w.split(","),function(e){return{name:(e=e.split("="))[0],value:e[1]}}),N=[],T.each(x,function(e){N.push({selectable:!0,text:e.name,data:e.value})}),h=N,a.on("click",function(e){var t=e.target;if("mce-spellchecker-word"==t.className){e.preventDefault();var n=function(e){var t,n=[];if((t=T.toArray(a.getBody().getElementsByTagName("span"))).length)for(var r=0;r<t.length;r++){var o=u(t[r]);null!==o&&o.length&&o===e.toString()&&n.push(t[r])}return n}(u(t));if(0<n.length){var r=a.dom.createRng();r.setStartBefore(n[0]),r.setEndAfter(n[n.length-1]),a.selection.setRng(r),o(t.getAttribute("data-mce-word"),n)}}}),a.addMenuItem("spellchecker",{text:"Spellcheck",context:"tools",onclick:e,selectable:!0,onPostRender:function(){var e=this;e.active(g),a.on("SpellcheckStart SpellcheckEnd",function(){e.active(g)})}});var S={tooltip:"Spellcheck",onclick:e,onPostRender:function(){var e=this;a.on("SpellcheckStart SpellcheckEnd",function(){e.active(g)})}};1<h.length&&(S.type="splitbutton",S.menu=h,S.onshow=function(e){var t=y.spellchecker_language;e.control.items().each(function(e){e.active(e.settings.data===t)})},S.onselect=function(e){y.spellchecker_language=e.control.settings.data}),a.addButton("spellchecker",S),a.addCommand("mceSpellCheck",e),a.on("remove",function(){m&&(m.remove(),m=null)}),a.on("change",s),this.getTextMatcher=n,this.getWordCharPattern=r,this.markErrors=f,this.getLanguage=function(){return y.spellchecker_language},y.spellchecker_language=y.spellchecker_language||y.language||"en"})}),function(e){var t,n,r,o,i;for(t=0;t<e.length;t++){n=a,o=(r=e[t]).split(/[.\/]/);for(var c=0;c<o.length-1;++c)n[o[c]]===l&&(n[o[c]]={}),n=n[o[c]];n[o[o.length-1]]=s[r]}if(a.AMDLC_TESTS){for(r in i=a.privateModules||{},s)i[r]=s[r];for(t=0;t<e.length;t++)delete i[e[t]];a.privateModules=i}}(["tinymce/spellcheckerplugin/DomTextMatcher"])}(this);