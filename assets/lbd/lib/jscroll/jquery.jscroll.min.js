!function(m){"use strict";m.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};function l(a,t){function s(){a.find(".jscroll-inner").length||a.contents().wrapAll('<div class="jscroll-inner" />')}function e(t){d.pagingSelector?t.closest(d.pagingSelector).hide():t.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide().length||t.wrap('<div class="jscroll-next-parent" />').parent().hide()}function r(){return p.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function l(){if(a.is(":visible")){s();var t=a.find("div.jscroll-inner").first(),n=a.data("jscroll"),e=parseInt(a.css("borderTopWidth"),10),l=isNaN(e)?0:e,o=parseInt(a.css("paddingTop"),10)+l,r=f?p.scrollTop():a.offset().top,i=t.length?t.offset().top:0,c=Math.ceil(r-i+p.height()+o);if(!n.waiting&&c+d.padding>=t.outerHeight())return b("info","jScroll:",t.outerHeight()-c,"from bottom. Loading next request..."),v()}}var n,o=a.data("jscroll"),i="function"==typeof t?{callback:t}:t,d=m.extend({},m.jscroll.defaults,i,o||{}),f="visible"===a.css("overflow-y"),c=a.find(d.nextSelector).first(),g=m(window),u=m("body"),p=f?g:a,j=m.trim(c.attr("href")+" "+d.contentSelector),h=function(){var t=a.find(d.nextSelector).first();if(t.length)if(d.autoTrigger&&(!1===d.autoTriggerUntil||0<d.autoTriggerUntil)){e(t);var n=u.height()-a.offset().top;(a.height()<n?a.height():n)<=(0<a.offset().top-g.scrollTop()?g.height()-(a.offset().top-m(window).scrollTop()):g.height())&&l(),p.unbind(".jscroll").bind("scroll.jscroll",function(){return l()}),0<d.autoTriggerUntil&&d.autoTriggerUntil--}else p.unbind(".jscroll"),t.bind("click.jscroll",function(){return e(t),v(),!1})},v=function(){var t=a.find("div.jscroll-inner").first(),o=a.data("jscroll");return o.waiting=!0,t.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading" id="jscroll-loading">'+d.loadingHtml+"</div>").promise().done(function(){d.loadingFunction&&d.loadingFunction()}),a.animate({scrollTop:t.outerHeight()},0,function(){var l=o.nextHref;t.find("div.jscroll-added").last().load(l,function(t,n){if("error"===n)return r();var e=m(this).find(d.nextSelector).first();o.waiting=!1,o.nextHref=!!e.attr("href")&&m.trim(e.attr("href")+" "+d.contentSelector),m(".jscroll-next-parent",a).remove(),function(t){(t=t||a.data("jscroll"))&&t.nextHref?h():(b("warn","jScroll: nextSelector not found - destroying"),r())}(),d.callback&&d.callback.call(this,l),b("dir",o)})})},b=function(t){if(d.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var n=[];for(var e in t)"function"==typeof console[e]?(n=t[e].length?t[e]:[t[e]],console[e].apply(console,n)):console.log.apply(console,n)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))};return a.data("jscroll",m.extend({},o,{initialized:!0,waiting:!1,nextHref:j})),s(),(n=m(d.loadingHtml).filter("img").attr("src"))&&((new Image).src=n),h(),m.extend(a.jscroll,{destroy:r}),a}m.fn.jscroll=function(e){return this.each(function(){var t=m(this),n=t.data("jscroll");n&&n.initialized||new l(t,e)})}}(jQuery);