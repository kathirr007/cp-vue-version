!function(m,s,r){var l=["p","div","pre","form"],c=[8,9,17,18,37,38,39,40,91,46];m.emojiarea={assetsPath:"",spriteSheetPath:"",blankGifPath:"",iconSize:25,icons:{}};var h=":joy:,:kissing_heart:,:heart:,:heart_eyes:,:blush:,:grin:,:+1:,:relaxed:,:pensive:,:smile:,:sob:,:kiss:,:unamused:,:flushed:,:stuck_out_tongue_winking_eye:,:see_no_evil:,:wink:,:smiley:,:cry:,:stuck_out_tongue_closed_eyes:,:scream:,:rage:,:smirk:,:disappointed:,:sweat_smile:,:kissing_closed_eyes:,:speak_no_evil:,:relieved:,:grinning:,:yum:,:laughing:,:ok_hand:,:neutral_face:,:confused:".split(",");m.fn.emojiarea=function(i){return i=m.extend({},i),this.each(function(){var e=m(this);if("contentEditable"in r.body&&!1!==i.wysiwyg){var t=getGuid();new a(e,t,m.extend({},i))}else{t=getGuid();new n(e,t,i)}e.attr({"data-emojiable":"converted","data-id":t,"data-type":"original-input"})})};var g={};g.restoreSelection=s.getSelection?function(e){var t=s.getSelection();t.removeAllRanges();for(var i=0,n=e.length;i<n;++i)t.addRange(e[i])}:r.selection&&r.selection.createRange?function(e){e&&e.select()}:void 0,g.saveSelection=s.getSelection?function(){var e=s.getSelection(),t=[];if(e.rangeCount)for(var i=0,n=e.rangeCount;i<n;++i)t.push(e.getRangeAt(i));return t}:r.selection&&r.selection.createRange?function(){var e=r.selection;return"none"!==e.type.toLowerCase()?e.createRange():null}:void 0,g.replaceSelection=s.getSelection?function(e){var t,i=s.getSelection(),n="string"==typeof e?r.createTextNode(e):e;i.getRangeAt&&i.rangeCount&&((t=i.getRangeAt(0)).deleteContents(),t.insertNode(n),t.setStart(n,0),s.setTimeout(function(){(t=r.createRange()).setStartAfter(n),t.collapse(!0),i.removeAllRanges(),i.addRange(t)},0))}:r.selection&&r.selection.createRange?function(e){var t=r.selection.createRange();"string"==typeof e?t.text=e:t.pasteHTML(e.outerHTML)}:void 0,g.insertAtCursor=function(e,t){e=" "+e;var i,n,a=t.value;void 0!==t.selectionStart&&void 0!==t.selectionEnd?(i=t.selectionStart,t.selectionEnd,t.value=a.substring(0,i)+e+a.substring(t.selectionEnd),t.selectionStart=t.selectionEnd=i+e.length):void 0!==r.selection&&void 0!==r.selection.createRange&&(t.focus(),(n=r.selection.createRange()).text=e,n.select())},g.extend=function(e,t){if(void 0!==e&&e||(e={}),"object"==typeof t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},g.escapeRegex=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},g.htmlEntities=function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},g.emojiInserted=function(i,e){ConfigStorage.get("emojis_recent",function(e){var t=(e=e||h||[]).indexOf(i);if(!t)return!1;-1!=t&&e.splice(t,1),e.unshift(i),42<e.length&&(e=e.slice(42)),ConfigStorage.set({emojis_recent:e})})};function d(){}d.prototype.setup=function(){var e=this;this.$editor.on("focus",function(){e.hasFocus=!0}),this.$editor.on("blur",function(){e.hasFocus=!1}),e.emojiMenu=new o(e),this.setupButton()},d.prototype.setupButton=function(){var t=this,e=m("[data-id="+this.id+"][data-type=picker]");e.on("click",function(e){t.emojiMenu.show(t)}),this.$button=e,this.$dontHideOnClick="emoji-picker"},d.createIcon=function(e,t){var i=e[0],n=e[1],a=e[2],o=e[3],s=m.emojiarea.spriteSheetPath?m.emojiarea.spriteSheetPath:m.emojiarea.assetsPath+"/emoji_spritesheet_!.png",r=m.emojiarea.blankGifPath?m.emojiarea.blankGifPath:m.emojiarea.assetsPath+"/blank.gif",c=t&&Config.Mobile?26:m.emojiarea.iconSize,l=-c*a,h=-c*n,d=Config.EmojiCategorySpritesheetDimens[i][1]*c,u=Config.EmojiCategorySpritesheetDimens[i][0]*c,p="display:inline-block;";return p+="width:"+c+"px;",p+="height:"+c+"px;",p+="background:url('"+s.replace("!",i)+"') "+l+"px "+h+"px no-repeat;",'<img src="'+r+'" class="img" style="'+(p+="background-size:"+d+"px "+u+"px;")+'" alt="'+g.htmlEntities(o)+'">'},m.emojiarea.createIcon=d.createIcon;var n=function(e,t,i){this.options=i,this.$textarea=e,this.$editor=e,this.id=t,this.setup()};n.prototype.insert=function(e){m.emojiarea.icons.hasOwnProperty(e)&&(g.insertAtCursor(e,this.$textarea[0]),g.emojiInserted(e,this.menu),this.$textarea.trigger("change"))},n.prototype.val=function(){return"\n"==this.$textarea?"":this.$textarea.val()},g.extend(n.prototype,d.prototype);var a=function(e,t,i){var n=this;this.options=i||{},"unicode"===m(e).attr("data-emoji-input")?this.options.inputMethod="unicode":this.options.inputMethod="image",this.id=t,this.$textarea=e,this.emojiPopup=i.emojiPopup,this.$editor=m("<div>").addClass("emoji-wysiwyg-editor").addClass(m(e)[0].className),this.$editor.data("self",this),e.attr("maxlength")&&this.$editor.attr("maxlength",e.attr("maxlength")),this.$editor.height(e.outerHeight()),this.emojiPopup.appendUnicodeAsImageToElement(this.$editor,e.val()),this.$editor.attr({"data-id":t,"data-type":"input",placeholder:e.attr("placeholder"),contenteditable:"true"});var a="blur change";this.options.norealTime||(a+=" keyup"),this.$editor.on(a,function(e){return n.onChange.apply(n,[e])}),this.$editor.on("mousedown focus",function(){r.execCommand("enableObjectResizing",!1,!1)}),this.$editor.on("blur",function(){r.execCommand("enableObjectResizing",!0,!0)});var o=this.$editor;this.$editor.on("change keydown keyup resize scroll",function(e){-1!=c.indexOf(e.which)||(e.ctrlKey||e.metaKey)&&65==e.which||(e.ctrlKey||e.metaKey)&&67==e.which||!(o.text().length+o.find("img").length>=o.attr("maxlength"))||e.preventDefault(),n.updateBodyPadding(o)}),this.$editor.on("paste",function(e){var t;e.preventDefault();var i=o.attr("maxlength")-(o.text().length+o.find("img").length);(e.originalEvent||e).clipboardData?(t=(e.originalEvent||e).clipboardData.getData("text/plain"),n.options.onPaste&&(t=n.options.onPaste(t)),i<t.length&&(t=t.substring(0,i)),r.execCommand("insertText",!1,t)):s.clipboardData&&(t=s.clipboardData.getData("Text"),n.options.onPaste&&(t=n.options.onPaste(t)),i<t.length&&(t=t.substring(0,i)),r.selection.createRange().pasteHTML(t)),o.scrollTop(o[0].scrollHeight)}),e.after("<i class='emoji-picker-icon emoji-picker "+this.options.popupButtonClasses+"' data-id='"+t+"' data-type='picker'></i>"),e.hide().after(this.$editor),this.setup(),m(r.body).on("mousedown",function(){n.hasFocus&&(n.selection=g.saveSelection())})};a.prototype.updateBodyPadding=function(e){var t=m("[data-id="+this.id+"][data-type=picker]");m(e).hasScrollbar()?(t.hasClass("parent-has-scroll")||t.addClass("parent-has-scroll"),m(e).hasClass("parent-has-scroll")||m(e).addClass("parent-has-scroll")):(t.hasClass("parent-has-scroll")&&t.removeClass("parent-has-scroll"),m(e).hasClass("parent-has-scroll")&&m(e).removeClass("parent-has-scroll"))},a.prototype.onChange=function(e){var t=new CustomEvent("input",{bubbles:!0});this.$textarea.val(this.val())[0].dispatchEvent(t)},a.prototype.insert=function(e){var t="";if("unicode"==this.options.inputMethod)t=this.emojiPopup.colonToUnicode(e);else{var i=m(d.createIcon(m.emojiarea.icons[e]));i[0].attachEvent&&i[0].attachEvent("onresizestart",function(e){e.returnValue=!1},!1),t=i[0]}this.$editor.trigger("focus"),this.selection&&g.restoreSelection(this.selection);try{g.replaceSelection(t)}catch(e){}g.emojiInserted(e,this.menu),this.onChange()},a.prototype.val=function(){function s(){e.push(r.join("")),r=[]}for(var e=[],r=[],t=this.emojiPopup,c=function(e){if(3===e.nodeType)r.push(e.nodeValue);else if(1===e.nodeType){var t=e.tagName.toLowerCase(),i=-1!==l.indexOf(t);if(i&&r.length&&s(),"img"===t){var n=e.getAttribute("alt")||"";return void(n&&r.push(n))}"br"===t&&s();for(var a=e.childNodes,o=0;o<a.length;o++)c(a[o]);i&&r.length&&s()}},i=this.$editor[0].childNodes,n=0;n<i.length;n++)c(i[n]);r.length&&s();var a=e.join("\n");return t.colonToUnicode(a)},g.extend(a.prototype,d.prototype),jQuery.fn.hasScrollbar=function(){var e=this.get(0).scrollHeight;return this.outerHeight()<e};var o=function(e){var i=this;i.id=e.id;var t=m(r.body);m(s);this.visible=!1,this.emojiarea=e,o.menuZIndex=5e3,this.$menu=m("<div>"),this.$menu.addClass("emoji-menu"),this.$menu.attr("data-id",i.id),this.$menu.attr("data-type","menu"),this.$menu.hide(),this.$itemsTailWrap=m('<div class="emoji-items-wrap1"></div>').appendTo(this.$menu),this.$categoryTabs=m('<table class="emoji-menu-tabs"><tr><td><a class="emoji-menu-tab icon-recent" ></a></td><td><a class="emoji-menu-tab icon-smile" ></a></td><td><a class="emoji-menu-tab icon-flower"></a></td><td><a class="emoji-menu-tab icon-bell"></a></td><td><a class="emoji-menu-tab icon-car"></a></td><td><a class="emoji-menu-tab icon-grid"></a></td></tr></table>').appendTo(this.$itemsTailWrap),this.$itemsWrap=m('<div class="emoji-items-wrap mobile_scrollable_wrap"></div>').appendTo(this.$itemsTailWrap),this.$items=m('<div class="emoji-items">').appendTo(this.$itemsWrap),this.emojiarea.$editor.after(this.$menu),t.on("keydown",function(e){27!==e.keyCode&&9!==e.keyCode||i.hide()}),t.on("message_send",function(e){i.hide()}),t.on("mouseup",function(e){var t=(e=e.originalEvent||e).target||s;if(!m(t).hasClass(i.emojiarea.$dontHideOnClick)){for(;t&&t!=s;)if((t=t.parentNode)==i.$menu[0]||i.emojiarea&&t==i.emojiarea.$button[0])return;i.hide()}}),this.$menu.on("mouseup","a",function(e){return e.stopPropagation(),!1}),this.$menu.on("click","a",function(e){if(i.emojiarea.updateBodyPadding(i.emojiarea.$editor),m(this).hasClass("emoji-menu-tab"))return i.getTabIndex(this)!==i.currentCategory&&i.selectCategory(i.getTabIndex(this)),!1;var t=m(".label",m(this)).text();return s.setTimeout(function(){i.onItemSelected(t),(e.ctrlKey||e.metaKey)&&i.hide()},0),e.stopPropagation(),!1}),this.selectCategory(0)};o.prototype.getTabIndex=function(e){return this.$categoryTabs.find(".emoji-menu-tab").index(e)},o.prototype.selectCategory=function(t){this.$categoryTabs.find(".emoji-menu-tab").each(function(e){e===t?this.className+="-selected":this.className=this.className.replace("-selected","")}),this.currentCategory=t,this.load(t)},o.prototype.onItemSelected=function(e){this.emojiarea.$editor.text().length+this.emojiarea.$editor.find("img").length>=this.emojiarea.$editor.attr("maxlength")||this.emojiarea.insert(e)},o.prototype.load=function(e){var n=[],a=m.emojiarea.icons,t=m.emojiarea.assetsPath,i=this;t.length&&"/"!==t.charAt(t.length-1)&&(t+="/");function o(){i.$items.html(n.join(""))}if(0<e){for(var s in a)a.hasOwnProperty(s)&&a[s][0]===e-1&&n.push('<a href="javascript:void(0)" title="'+g.htmlEntities(s)+'">'+d.createIcon(a[s],!0)+'<span class="label">'+g.htmlEntities(s)+"</span></a>");o()}else ConfigStorage.get("emojis_recent",function(e){var t,i;for(e=e||h||[],i=0;i<e.length;i++)t=e[i],a[t]&&n.push('<a href="javascript:void(0)" title="'+g.htmlEntities(t)+'">'+d.createIcon(a[t],!0)+'<span class="label">'+g.htmlEntities(t)+"</span></a>");o()})},o.prototype.hide=function(e){this.visible=!1,this.$menu.hide("fast")},o.prototype.show=function(e){if(this.visible)return this.hide();m(this.$menu).css("z-index",++o.menuZIndex),this.$menu.show("fast"),this.currentCategory||this.load(0),this.visible=!0}}(jQuery,window,document);